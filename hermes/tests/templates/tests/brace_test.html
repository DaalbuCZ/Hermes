{% extends "base.html" %}
{% load unicorn %}
{% load static %}
{% block title %}
  Brace Test
{% endblock title %}
{% block extra_css %}
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css"
        rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
  <link rel="stylesheet" href="{% static 'css/test_styles.css' %}" />
{% endblock extra_css %}
{% block content %}
  {% unicorn_scripts %}
  <h2>Brace Test</h2>
  <div class="container">
    <div class="profile-selector">
      <label for="profile_search">Select Profile:</label>
      <input type="text"
             id="profile_search"
             placeholder="Search profiles..."
             autocomplete="off" />
      <ul id="profile_list" class="dropdown-content">
        {% for profile in profiles %}
          <li data-value="{{ profile.id }}">{{ profile.surname }} {{ profile.name }}</li>
        {% endfor %}
      </ul>
      <input type="hidden" name="profile_id" id="profile_id" />
    </div>
    {% unicorn 'brace-score' %}
  </div>
{% endblock content %}
{% block extra_js %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>
  <script>
  $(document).ready(function () {
    $("#profile_search").on("keyup focus", function () {
      var value = $(this).val().toLowerCase();
      $("#profile_list li").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
      $("#profile_list").show();
    });

    $("#profile_list li").on("click", function () {
      var selectedText = $(this).text();
      var selectedValue = $(this).data("value");
      $("#profile_search").val(selectedText);
      $("#profile_id").val(selectedValue);
      $("#profile_list").hide();

      try {
        Unicorn.call("brace-score", "update_profile", selectedValue);
      } catch (error) {
        console.error("Error updating profile in Unicorn component:", error);
      }
    });

    $(document).on("click", function (e) {
      if (!$(e.target).closest("#profile_search, #profile_list").length) {
        $("#profile_list").hide();
      }
    });
  });
  </script>
{% endblock extra_js %}
